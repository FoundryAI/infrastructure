{
  "Resources": {
    "Service": {
      "Type": "AWS::ECS::Service",
      "DependsOn": "TaskDefinition",
      "Properties": {
        "Cluster": "${cluster_name}",
        "Role": "${role_id}",
        "DesiredCount": "${desired_count}",
        "TaskDefinition": {
            "Ref": "TaskDefinition"
        },
        "LoadBalancers": [
          {
            "ContainerName": "${container_name}",
            "ContainerPort": "${container_port}",
            "LoadBalancerName": "${elb_id}"
          }
        ]
      }
    },
    "TaskDefinition": {
      "Type": "AWS::ECS::TaskDefinition",
      "Properties": {
        "Family": "${name}",
        "ContainerDefinitions": [
          {
            "Name": "${name}",
            "Image": "${repository_url}:${image_version}",
            "Essential": "true",
            "Memory": "${memory}",
            "Cpu": "${cpu}",
            "PortMappings": [
              {
                "ContainerPort": ${container_port},
                "HostPort": ${port}
              }
            ],
            "LogConfiguration": {
                "LogDriver": "awslogs",
                "Options": {
                    "awslogs-group": "${awslogs_group}",
                    "awslogs-region": "${awslogs_region}",
                    "awslogs-stream-prefix": "${awslogs_stream_prefix}"
                }
            },
            "Environment": ${container_env_vars}
          }
        ]
      }
    }
  }
}